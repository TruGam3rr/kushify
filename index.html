<!DOCTYPE html>
<html>
<head>
	<title>kushify</title>
	<link href='http://fonts.googleapis.com/css?family=Chau+Philomene+One:400,400italic' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" href="style.css">
	<link rel="stylesheet" type="text/css" href="css/tooltipster.css" />
	<script type="text/javascript" src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="js/jquery.tooltipster.min.js"></script>
    <script type="text/javascript" src="js/crypt.js"></script>
	<script type="text/javascript">
	 //Preload Images
	$.fn.preload = function () {
	    this.each(function () {
	        $('<img/>')[0].src = this;
	    });
	}

	$(['weed.jpg', 'weedbg.jpg', 'weedarrow.jpg', 'coffee.jpg', 'coffeebg.jpg', 'coffeearrow.jpg', 'money.jpg', 'moneybg.jpg', 'moneyarrow.jpg', 'fertilizer.jpg', 'fertilizerbg.jpg', 'fertilizerarrow.jpg']).preload();

	 //Savegame
	var saveCrypt = "";

	 //Coffe or Kush
	var coffeeMod = false;
	var weedOrCoffee = 'weed';

	 //Quality Settings
	var particlesDeactivated = false;
	var menuflipDeactivated = false;

	 //Resources and Resourceflow
	var money = 0; //Resource
	var mps = 0; //Income per Second | it's actually income / expense per 1/10th second. So 1 amps = 0.1 mps
	var mes = 0; //Expense per Second

	var weed = 20; //starting values
	var wps = 0;
	var wes = 0;

	var fertilizer = 10; //starting values
	var fps = 0;
	var fes = 0;

	 //Clicked Amount
	var cursorPower = 1;

	 //Intro Handling
	var introstep = 0;

	 //Facility and DataHeap
	var facilities = new Array(); //dealer, trailer, greenhouse, export1, etc
	facilities[0] = new Array(0, 15, 'dealer', 0.01, 0.05); //amount, price, name, expense, income DEALER
	facilities[1] = new Array(0, 30, 'trailer', 0.01, 0.05); //Trailer
	facilities[2] = new Array(0, 5000, 'appartment', 1.5, 8); //Appartment
	facilities[3] = new Array(0, 3000, 'export1', 1.8, 10); //Export1
	facilities[4] = new Array(0, 500, 'enchantcursor1'); //Echantcursor1
	facilities[5] = new Array(0, 40, 'fakefarm', 0.03, 0.05); //Fakefarm
	facilities[6] = new Array(0, 3500, 'fakefarm2', 4, 8.5); //Fakefarm2
	facilities[7] = new Array(0, 100000, 'export2', 60, 340); //export2
	facilities[8] = new Array(0, 140000, 'greenhouse', 40, 225); //greenhouse

	 //Infrastructure Intervention
	var dealersFrozen = false;
	var weedersFrozen = false;
	var tradersFrozen = false;

	function clicked(type) {
	    if (type == 'fertilizer') {
	        fertilizer = fertilizer + (cursorPower / 2);
	    };
	    if (type == 'weed') {
	        weed = weed + cursorPower;
	    };
	    if (type == 'money') {
	        money = money + cursorPower;
	        if (introstep == 2) {
	            introHandler(true);
	        };
	    };
	}

	$(function () {
	    setInterval(wpsHandler, 100);
	});
	$(function () {
	    setInterval(titleUpdater, 3000);
	});
	$(function () {
	    setInterval(saveGame, 60000);
	});

	function titleUpdater() {
	    if (coffeeMod === true) {
	        document.title = addCommas(Math.round(money)) + "$ - coffeefy";
	    } else {
	        document.title = addCommas(Math.round(money)) + "$ - kushify";
	    }

	    // System that paints buttons red when the respective resource is empty, but it conflicts a bit in the early game because of the intro etc. we might fire the loop rehearsing this only after the intro is over
	    /*if (dealersFrozen == true) { $('#weed').addClass('alert');}
		else { $('#weed').removeClass('alert')}
		if (weedersFrozen == true) { $('#fertilizer').addClass('alert');}
		else { $('#fertilizer').removeClass('alert')}
		if (tradersFrozen == true) { $('#money').addClass('alert');}
		else { $('#money').removeClass('alert')}*/
	}

	function wpsHandler() {
	    if (weed < 0.5) {
	        dealersFrozen = true;
	    } //freeze dealers once no weed is available
	    else {
	        dealersFrozen = false;
	    } //once weed is available, reenable dealerflow
	    if (money < 0.5) {
	        tradersFrozen = true;
	    } else {
	        tradersFrozen = false;
	    }
	    if (fertilizer < 0.5) {
	        weedersFrozen = true;
	    } else {
	        weedersFrozen = false;
	    }

	    if (dealersFrozen == false) {
	        money = money + mps;
	        weed = weed - wes;
	    }; //if dealers are running, add money and distract weed
	    if (weedersFrozen == false) {
	        fertilizer = fertilizer - fes;
	        weed = weed + wps;
	    }; //if weeders are running, add weed and distract fertilizers
	    if (tradersFrozen == false) {
	        fertilizer = fertilizer + fps;
	        money = money - mes;
	    }; //if traders are running, add fertilizer and distract money

	    $('#fertilizerspan').text(addCommas(Math.round(fertilizer))); //print
	    $('#weedspan').text(addCommas(Math.round(weed)));
	    $('#moneyspan').text(addCommas(Math.round(money)));
	}

	function buyStuff(facility) {
	    if (facility === 'dealer') {
	        if (money > (increasePrice(0, (facilities[0][0] + 1)) - 1)) { //check money
	            facilities[0][0]++; //add one dealer
	            money = money - increasePrice(0, facilities[0][0]); //distract money

	            wes = wes + 0.01; //increase weed expense
	            mps = mps + 0.05; //increase money per second

	            var printString = facilities[0][0] + " Dealer - buy for " + addCommas(Math.round(increasePrice(0, (facilities[0][0] + 1)))) + "$";
	            $('.dealer').text(printString); //print
	            updatePerSecond();

	            if (introstep == 3) {
	                introHandler();
	            };
	            return;
	        };
	        $(".dealer").css("background-color", "rgba(255,80,80,0.9)");
	        setTimeout(function () {
	            $(".dealer").css("background-color", "");
	        }, 1000);
	        return;
	    };
	    if (facility === 'trailer') {
	        if (money > (increasePrice(1, (facilities[1][0] + 1)) - 1)) { //check money
	            facilities[1][0]++; //add one trailer
	            money = money - increasePrice(1, facilities[1][0]); //distract money

	            wps = wps + 0.05; // increase weed per second
	            fes = fes + 0.01; // increase fertilizer expense

	            var printString = facilities[1][0] + " Trailer - buy for " + addCommas(Math.round(increasePrice(1, (facilities[1][0] + 1)))) + "$";
	            $('.trailer').text(printString);
	            updatePerSecond();
	            return;
	        };
	        $(".trailer").css("background-color", "rgba(255,80,80,0.9)");
	        setTimeout(function () {
	            $(".trailer").css("background-color", "");
	        }, 1000);
	        return;
	    };
	    if (facility === 'export1') {
	        if (money > (increasePrice(3, (facilities[3][0] + 1)) - 1)) { //check money
	            facilities[3][0]++; //add one mafia connection
	            money = money - increasePrice(3, facilities[3][0]); //distract money

	            wes = wes + 1.8; //increase weed expense
	            mps = mps + 10; //increase money per second

	            var printString = facilities[3][0] + " Coffee Shops - buy for " + addCommas(Math.round(increasePrice(3, (facilities[3][0] + 1)))) + "$";
	            $('.export1').text(printString); //print
	            updatePerSecond();
	            return;
	        };
	        $(".export1").css("background-color", "rgba(255,80,80,0.9)");
	        setTimeout(function () {
	            $(".export1").css("background-color", "");
	        }, 1000);
	        return;
	    };
	    if (facility === 'appartment') {
	        if (money > (increasePrice(2, (facilities[2][0] + 1)) - 1)) { //check money
	            facilities[2][0]++; //add one trailer
	            money = money - increasePrice(2, facilities[2][0]); //distract money

	            wps = wps + 8; // increase weed per second
	            fes = fes + 1.5; // increase fertilizer expense

	            var printString = facilities[2][0] + " Hippie Appartments - buy for " + addCommas(Math.round(increasePrice(2, (facilities[2][0] + 1)))) + "$";
	            $('.appartment').text(printString);
	            updatePerSecond();
	            return;
	        };
	        $(".appartment").css("background-color", "rgba(255,80,80,0.9)");
	        setTimeout(function () {
	            $(".appartment").css("background-color", "");
	        }, 1000);
	        return;
	    };
	    if (facility === 'enchantcursor1') {
	        if (weed > (increasePrice(4, (facilities[4][0] + 1)) - 1)) { //check weed
	            facilities[4][0]++; //add one
	            weed = weed - increasePrice(4, facilities[4][0]); //distract weed

	            cursorPower = cursorPower + 1.5; // enhance Power

	            var printString = facilities[4][0] + " Cursor Enchantments - buy for " + addCommas(Math.round(increasePrice(4, (facilities[4][0] + 1)))) + "g";
	            $('.enchantcursor1').text(printString);
	            updatePerSecond();
	            return;
	        };
	        $(".enchantcursor1").css("background-color", "rgba(255,80,80,0.9)");
	        setTimeout(function () {
	            $(".enchantcursor1").css("background-color", "");
	        }, 1000);
	        return;
	    };
	    if (facility === 'fakefarm') {
	        if (money > (increasePrice(5, (facilities[5][0] + 1)) - 1)) { //check weed
	            facilities[5][0]++; //add one
	            money = money - increasePrice(5, facilities[5][0]); //distract weed

	            mes = mes + 0.03; //increase money expense
	            fps = fps + 0.05; //increase fertilizer per second

	            var printString = facilities[5][0] + " Undercover Farms - buy for " + addCommas(Math.round(increasePrice(5, (facilities[5][0] + 1)))) + "$";
	            $('.fakefarm').text(printString);
	            updatePerSecond();
	            return;
	        };
	        $(".fakefarm").css("background-color", "rgba(255,80,80,0.9)");
	        setTimeout(function () {
	            $(".fakefarm").css("background-color", "");
	        }, 1000);
	        return;
	    };
	    if (facility === 'fakefarm2') {
	        if (money > (increasePrice(6, (facilities[6][0] + 1)) - 1)) { //check weed
	            facilities[6][0]++; //add one
	            money = money - increasePrice(6, facilities[6][0]); //distract weed

	            mes = mes + 4; //increase money expense
	            fps = fps + 8.5; //increase fertilizer per second

	            var printString = facilities[6][0] + " Nuclear Waste Facilities - buy for " + addCommas(Math.round(increasePrice(6, (facilities[6][0] + 1)))) + "$";
	            $('.fakefarm2').text(printString);
	            updatePerSecond();
	            return;
	        };
	        $(".fakefarm2").css("background-color", "rgba(255,80,80,0.9)");
	        setTimeout(function () {
	            $(".fakefarm2").css("background-color", "");
	        }, 1000);
	        return;
	    };
	    if (facility === 'export2') {
	        if (money > (increasePrice(7, (facilities[7][0] + 1)) - 1)) { //check money
	            facilities[7][0]++; //add one mafia connection
	            money = money - increasePrice(7, facilities[7][0]); //distract money

	            wes = wes + 60; //increase weed expense
	            mps = mps + 340; //increase money per second

	            var printString = facilities[7][0] + " Mafia Contracts - buy for " + addCommas(Math.round(increasePrice(7, (facilities[7][0] + 1)))) + "$";
	            $('.export2').text(printString); //print
	            updatePerSecond();
	            return;
	        };
	        $(".export2").css("background-color", "rgba(255,80,80,0.9)");
	        setTimeout(function () {
	            $(".export2").css("background-color", "");
	        }, 1000);
	        return;
	    };
	    if (facility === 'greenhouse') {
	        if (money > (increasePrice(8, (facilities[8][0] + 1)) - 1)) { //check money
	            facilities[8][0]++; //add one trailer
	            money = money - increasePrice(8, facilities[8][0]); //distract money

	            wps = wps + 225; // increase weed per second
	            fes = fes + 40; // increase fertilizer expense

	            var printString = facilities[8][0] + " Greenhouses - buy for " + addCommas(Math.round(increasePrice(8, (facilities[8][0] + 1)))) + "$";
	            $('.greenhouse').text(printString);
	            updatePerSecond();
	            return;
	        };
	        $(".greenhouse").css("background-color", "rgba(255,80,80,0.9)");
	        setTimeout(function () {
	            $(".greenhouse").css("background-color", "");
	        }, 1000);
	        return;
	    };
	}

	function checkSpeed() { // check all transfer and gain speeds and apply respective animations to arrow and ps
	    // all values / 10, because of the 10 times per second update

	    $('#weed, #weedspan').removeClass();

	    if ((wps - wes) > 0 && (wps - wes) <= 1) {
	        $('#weed').removeClass('pulsefast pulsemed').addClass('pulseslow');
	    };
	    if ((wps - wes) >= 1 && (wps - wes) <= 4) {
	        $('#weed').removeClass('pulsefast pulseslow').addClass('pulsemed');
	    };
	    if ((wps - wes) >= 4) {
	        $('#weed').removeClass('pulseslow pulsemed').addClass('pulsefast');
	    };
	    if ((wps - wes) < 0) {
	        $('#weedspan').addClass('decline');
	    };

	    $('#money, #moneyspan').removeClass();

	    if ((mps - mes) > 0 && (mps - mes) <= 2) {
	        $('#money').removeClass('pulsefast pulsemed').addClass('pulseslow');
	    };
	    if ((mps - mes) >= 2 && (mps - mes) <= 8) {
	        $('#money').removeClass('pulsefast pulseslow').addClass('pulsemed');
	    };
	    if ((mps - mes) >= 8) {
	        $('#money').removeClass('pulseslow pulsemed').addClass('pulsefast');
	    };
	    if ((mps - mes) < 0) {
	        $('#moneyspan').addClass('decline');
	    };

	    $('#fertilizer, #fertilizerspan').removeClass();

	    if ((fps - fes) > 0 && (fps - fes) <= 0.8) {
	        $('#fertilizer').removeClass('pulsefast pulsemed').addClass('pulseslow');
	    };
	    if ((fps - fes) >= 0.8 && (fps - fes) <= 2.0) {
	        $('#fertilizer').removeClass('pulsefast pulseslow').addClass('pulsemed');
	    };
	    if ((fps - fes) >= 2.0) {
	        $('#fertilizer').removeClass('pulseslow pulsemed').addClass('pulsefast');
	    };
	    if ((fps - fes) < 0) {
	        $('#fertilizerspan').addClass('decline');
	    };

	    $('.arrow').addClass('flownone');

	    if (wes > 0 && wes <= 0.5) {
	        $('.wtom').removeClass('flownone flowmed flowfast').addClass('flowslow');
	    };
	    if (wes >= 0.5 && wes <= 1.5) {
	        $('.wtom').removeClass('flownone flowslow flowfast').addClass('flowmed');
	    };
	    if (wes >= 1.5) {
	        $('.wtom').removeClass('flownone flowslow flowmed').addClass('flowfast');
	    };

	    if (mes > 0 && mes <= 0.5) {
	        $('.mtof').removeClass('flownone flowimed flowifast').addClass('flowislow');
	    };
	    if (mes >= 0.5 && mes <= 1.5) {
	        $('.mtof').removeClass('flownone flowislow flowifast').addClass('flowimed');
	    };
	    if (mes >= 1.5) {
	        $('.mtof').removeClass('flownone flowislow flowimed').addClass('flowifast');
	    };

	    if (fes > 0 && fes <= 0.5) {
	        $('.ftow').removeClass('flownone flowfast flowmed').addClass('flowslow');
	    };
	    if (fes >= 0.5 && fes <= 1.5) {
	        $('.ftow').removeClass('flownone flowfast flowslow').addClass('flowmed');
	    };
	    if (fes >= 1.5) {
	        $('.ftow').removeClass('flownone flowslow flowmed').addClass('flowfast');
	    };
	}

	function updatePerSecond() {
	    $('.mps').text(addCommas(Math.round((mps - mes) * 10 * 100) / 100)); //update X/s indicators
	    $('.fps').text(addCommas(Math.round((fps - fes) * 10 * 100) / 100));
	    $('.wps').text(addCommas(Math.round((wps - wes) * 10 * 100) / 100));
	    $('.wtom').text(addCommas(Math.round(wes * 10 * 100) / 100)); //update arrows
	    $('.ftow').text(addCommas(Math.round(fes * 10 * 100) / 100));
	    $('.mtof').text(addCommas(Math.round(mes * 10 * 100) / 100));
	    checkSpeed(); //check for pulse animations
	}

	function increasePrice(facility, number) {
	    //var Price = facilities[facility][1] * (((Math.sqrt(number) / 2) + (Math.pow((number / 100), 4) / 100)) + 0.5);
	    var Price = facilities[facility][1] * Math.pow(1.05, (number - 1));
	    return Price;
	}


	function introHandler(moneyTriggered) {
	    if (introstep == 0) {
	        $('#introtext').text('This is money.');
	        $('#money').fadeIn().removeClass('intro');
	        introstep++;
	        return;
	    };
	    if (introstep == 1) {
	        $('#introtext').text('Click on it.');
	        $('#introbutton').fadeOut();
	        introstep++;
	        return;
	    };
	    if (moneyTriggered == true) {
	        introstep++;
	        $('#skipintro').fadeOut();
	        $('#introtext').text('You like money.');
	        setTimeout(function () {
	            $('#introtext').text('Who the fuck doesnt?')
	        }, 3000);
	        setTimeout(function () {
	            $('#introtext').text('Good.')
	        }, 5000);
	        setTimeout(function () {
	            $('#intro').addClass('side')
	        }, 6000);
	        setTimeout(function () {
	            $('#weed').fadeIn().removeClass('intro')
	        }, 6200);
	        setTimeout(function () {
	            $('#introtext').text('Now this is ' + weedOrCoffee + '.')
	        }, 7000);
	        setTimeout(function () {
	            $('#introtext').text('You may like ' + weedOrCoffee + '.')
	        }, 9000);
	        setTimeout(function () {
	            $('#introtext').text('Or you may not, but you can sell that shit.')
	        }, 11000);
	        setTimeout(function () {
	            $('#introtext').text('But thats annoying and fucking dangerous.')
	        }, 13000);
	        setTimeout(function () {
	            $('#introtext').text('So hire some idiot to do it for you!')
	        }, 15000);
	        setTimeout(function () {
	            $('#containerwtom').fadeIn().removeClass('intro');
	            $('.dealer').fadeIn().removeClass('intro');
	            $('#title').addClass('sizedown')
	        }, 15000);
	        return;
	    }

	    if (introstep == 3) {
	        introstep++;
	        $('#intro').removeClass('side').addClass('tiny');
	        $('#introtext').text('Good job. Now rise!');
	        $('.intro').fadeIn('400').removeClass('intro');
	        setTimeout(function () {
	            $('#intro').fadeOut()
	        }, 3000);
	    }
	}

	function skipIntro() {
	    $('#intro').remove().fadeOut();
	    $('.intro').fadeIn().removeClass('intro');
	    $('#title').addClass('sizedown');
	}

	function addCommas(nStr) {
	    nStr += '';
	    var x = nStr.split('.');
	    var x1 = x[0];
	    var x2 = x.length > 1 ? '.' + x[1] : '';
	    var rgx = /(\d+)(\d{3})/;
	    while (rgx.test(x1)) {
	        x1 = x1.replace(rgx, '$1' + ',' + '$2');
	    }
	    return x1 + x2;
	}

	function cheatNow() {
	    var cheat = prompt('Enter the secret word!');
	    if (cheat == 'whatup') {
	        money = 5000;
	        weed = 5000;
	        fertilizer = 5000;
	    };
	    if (cheat == 'cmon') {
	        money = 100000;
	        weed = 100000;
	        fertilizer = 100000;
	    };
	}

	function saveGame(useTextfield) {
	    var saveRaw = Math.round(money) + "%" + Math.round(weed) + "%" + Math.round(fertilizer) + "%" + facilities[0][0] + "%" + facilities[1][0] + "%" + facilities[2][0] + "%" + facilities[3][0] + "%" + facilities[4][0] + "%" + facilities[5][0] + "%" + facilities[6][0] + "%" + facilities[7][0] + "%" + facilities[8][0] + "%" + coffeeMod;
	    saveCrypt = encode64(saveRaw);
	    if (useTextfield === true) {
	        $('#saveForm').val(saveCrypt);
	    } else {
	        setCookie("kushify_savegame", saveCrypt, 30);
	        var reg = getCookie("kushify_savegame");
	    	if (reg == saveCrypt) {
	        	$("#alertMessage").fadeIn(400);
	        	setTimeout("$('#alertMessage').fadeOut(400)", 2e3);
	        }
	        else {
	        	$("#alertMessage2").fadeIn(400);
	        	setTimeout("$('#alertMessage2').fadeOut(400)", 2e3);
	        }
	    }
	}

	function loadGame(useCookie, doSkipIntro) {
	    if (useCookie === true) {
	        var cryptedSave = getCookie("kushify_savegame");
	    } else {
	        var cryptedSave = $('#saveForm').val();
	        if (cryptedSave === "" || decode64(cryptedSave) === false) { //check if input is empty or contains illegal chars
	            alert('Save Corrupt! Empty or illegal characters found!');
	            return;
	        }
	    }

	    var saveState = decode64(cryptedSave); //Decode the Save
	    var saveArray = saveState.split("%"); //Split on all %
	    //alert(saveArray.length); (Debug)

	    for (var i = 0; i < 11; i++) { //check if any of the values from 0 - 11 is NaN
	        var numberResult = Number(saveArray[i]);
	        //alert("Run " + i + " - " + saveArray[i] + " - " + numberResult); (Debug)
	        if (isNaN(numberResult)) {
	            alert('Save Corrupt! Values are illegal!');
	            return;
	        }
	    }

	    var newMoney = Number(saveArray[0]);
	    money = newMoney; //define new money

	    var newWeed = Number(saveArray[1]);
	    weed = newWeed; //define new weed

	    var newFertilizer = Number(saveArray[2]);
	    fertilizer = newFertilizer; //define new fertilizer


	    for (var i = 0; i < facilities.length; i++) { //define the new amounts of every facility
	        facilities[i][0] = Number(saveArray[(i + 3)]);
	    }

	    if (saveArray[12] == 'true') {
	        coffeefy();
	        $('#switch').prop('checked', false);
	    } else {
	        coffeefy(true);
	        $('#switch').prop('checked', true);
	    }

	    //calculate the new expenses and gains from the facilities
	    wes = (facilities[0][3] * facilities[0][0]) + (facilities[3][3] * facilities[3][0]) + (facilities[7][3] * facilities[7][0]);
	    mes = (facilities[5][3] * facilities[5][0]) + (facilities[6][3] * facilities[6][0]);
	    fes = (facilities[1][3] * facilities[1][0]) + (facilities[8][3] * facilities[8][0]) + (facilities[8][3] * facilities[8][0]);

	    mps = (facilities[0][4] * facilities[0][0]) + (facilities[3][4] * facilities[3][0]) + (facilities[7][4] * facilities[7][0]);
	    fps = (facilities[5][4] * facilities[5][0]) + (facilities[6][4] * facilities[6][0]);
	    wps = (facilities[1][4] * facilities[1][0]) + (facilities[2][4] * facilities[2][0]) + (facilities[8][4] * facilities[8][0]);

	    cursorPower = 1 + (1.5 * facilities[4][0]);

	    //print new amounts of facilities aswell as prices
	    var printString = facilities[0][0] + " Dealer - buy for " + addCommas(Math.round(increasePrice(0, (facilities[0][0] + 1)))) + "$";
	    $('.dealer').text(printString);
	    printString = facilities[1][0] + " Trailer - buy for " + addCommas(Math.round(increasePrice(1, (facilities[1][0] + 1)))) + "$";
	    $('.trailer').text(printString);
	    printString = facilities[3][0] + " Coffee Shops - buy for " + addCommas(Math.round(increasePrice(3, (facilities[3][0] + 1)))) + "$";
	    $('.export1').text(printString);
	    printString = facilities[2][0] + " Hippie Appartments - buy for " + addCommas(Math.round(increasePrice(2, (facilities[2][0] + 1)))) + "$";
	    $('.appartment').text(printString);
	    printString = facilities[4][0] + " Cursor Enchantments - buy for " + addCommas(Math.round(increasePrice(4, (facilities[4][0] + 1)))) + "g";
	    $('.enchantcursor1').text(printString);
	    printString = facilities[5][0] + " Undercover Farms - buy for " + addCommas(Math.round(increasePrice(5, (facilities[5][0] + 1)))) + "$";
	    $('.fakefarm').text(printString);
	    printString = facilities[6][0] + " Nuclear Waste Facilities - buy for " + addCommas(Math.round(increasePrice(6, (facilities[6][0] + 1)))) + "$";
	    $('.fakefarm2').text(printString);
	    printString = facilities[7][0] + " Mafia Contracts - buy for " + addCommas(Math.round(increasePrice(7, (facilities[7][0] + 1)))) + "$";
	    $('.export2').text(printString);
	    printString = facilities[8][0] + " Greenhouses - buy for " + addCommas(Math.round(increasePrice(8, (facilities[8][0] + 1)))) + "$";
	    $('.greenhouse').text(printString);

	    $("#alertMessage3").fadeIn(400);
	    setTimeout("$('#alertMessage3').fadeOut(400)", 2e3);

	    //update all per second indicators, apply new animation
	    updatePerSecond();
	}

	 // COOKIE SAVE AND CHECK
	function setCookie(cname, cvalue, exdays) {
	    var d = new Date();
	    d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
	    var expires = "expires=" + d.toGMTString();
	    document.cookie = cname + "=" + cvalue + "; " + expires;
	}

	function getCookie(cname) {
	    var name = cname + "=";
	    var ca = document.cookie.split(';');
	    for (var i = 0; i < ca.length; i++) {
	        var c = ca[i].trim();
	        if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
	    }
	    return "";
	}

	function checkCookie() {
	    var reg = getCookie("kushify_savegame");
	    if (reg != "") {
	        skipIntro();
	        loadGame(true);
	    }
	}

	function clearCookie() {
	    setCookie("kushify_savegame", "", 30);
	}

	function coffeefy(classic) {
	    if (classic === true) {
	        coffeeMod = false;
	        $("#weed").css("background", "url(weed.jpg) top center").css("background-position-y", "-5px");
	        $("#containerwtom").css("background", "url('weedbg.jpg')");
	        $(".wtom").css("background", "url(weedarrow.jpg) repeat");
	        $('#title').text('KUSHIFY');
	        weedOrCoffee = 'weed';
	        $('.kushify').fadeOut("400", function () {
	            $('.coffeefy').fadeIn();
	        });
	        return;
	    };
	    coffeeMod = true;
	    $("#weed").css("background", "url(coffee.jpg) top center").css("background-position-y", "-5px");
	    $("#containerwtom").css("background", "url('coffeebg.jpg')");
	    $(".wtom").css("background", "url(coffeearrow.jpg) repeat");
	    $('#title').text('COFFEFY');
	    weedOrCoffee = 'coffee';
	    $('.coffeefy').fadeOut("400", function () {
	        $('.kushify').fadeIn();
	    });

	}


	$(document).ready(function () {
		$('.tooltip').tooltipster();
	    checkCookie();
	    var hash = window.location.hash;
	    if (hash == '#coffee') {
	        coffeefy();
	        $('#switch').prop('checked', false);
	    }
	    $('#introbutton, #skipintro').fadeIn('100');

	    $("#switch").change(function () {
	        if ($('#switch').prop('checked')) {
	            coffeefy(true);
	        } else {
	            coffeefy();
	        }
	    });

	    $("#switch2").change(function () {
	        if ($('#switch2').prop('checked')) {
	            particlesDeactivated = false;
	            //menuflipDeactivated = false; meny doesnt seem to like being interfered with. wip.
	        } else {
	            particlesDeactivated = true;
	            //menuflipDeactivated = true; meny doesnt seem to like being interfered with. wip.
	        }
	    });

	    $('.dealer').tooltipster({ content: $('<span>A poor bastard that will sell your stuff on the street. <span>+ 0.5$/s</span> | <span>- 0.1g/s</span></span>') });
	    $('.trailer').tooltipster({ content: $('<span>An old and shabby trailer with some hippies in it, growing kush and consuming fertilizer. <span>+ 0.5g/s</span> | <span>- 0.1u/s</span></span>') });
		$('.appartment').tooltipster({ content: $('<span>A place with a THC/air ratio of approximately 1:2 full of dedicated potheads to nourish your plants. <span>+ 80g/s</span> | <span>- 15u/s</span></span>') });
		$('.greenhouse').tooltipster({ content: $('<span>After paying some bribes to the local police, you can now reign over entire Greenhouses full of plants. <span>+ 2250g/s</span> | <span>- 400u/s</span></span>') });
		$('.export1').tooltipster({ content: $('<span>You start a weed retail store, with the convenient side effect of hot espresso and fresh cookies. <span>+ 100$/s</span> | <span>- 18g/s</span></span>') });
		$('.export2').tooltipster({ content: $('<span>Taking weed economy to a new level, this relationship will make you rich, and maybe endanger your life. <span>+ 3400$/s</span> | <span>- 600g/s</span></span>') });
		$('.fakefarm').tooltipster({ content: $('<span>A local farmer that will now buy fertilizer under his name and give it to you, while of course taking your money. <span>+ 0.5u/s</span> | <span>- 0.3$/s</span></span>') });
		$('.fakefarm2').tooltipster({ content: $('<span>By blackmailing some officials, you manage to take over a whole facility full of potential fertilizer. Once mixed with money. <span>+ 84g/s</span> | <span>- 40$/s</span></span>') });
		$('.enchantcursor1').tooltipster({ content: $('<span>By smearing some stash on your gaming mouse, you managed to unlock a secret rapid fire button.</span>') });
	});
	</script>
</head>
<body>

<div class="meny">
	<p><b class="tooltip" title="JK (c)">KUSHIFY &#945; 2.1.3</b><br><br>

	   <a class="intro" onclick="saveGame(true)">Export Save</a> 
	   <a class="intro tooltip" title="Careful! Load up the save you entered." onclick="loadGame()">Import Save</a> 
	   <a class="intro" onclick="saveGame()">Save</a> 
	   <a class="intro tooltip" title="Refresh the data from the last save" onclick="loadGame(true)">Load</a> 
	   <span class="kushify-switch tooltip" title="Hit switch if at work or in other imminent danger">
	   	<input id="switch" type="checkbox" class="input-switch" checked="checked"/>
	   	<label for="switch"></label><span class="switch-bg"></span>
	   	<span data-on="Kush" data-off="Coffee" class="switch-labels"></span>
	   </span> 
	   <span class="kushify-switch tooltip" title="Toggle Particles">
	   	<input id="switch2" type="checkbox" class="input-switch" checked="checked"/>
	   	<label for="switch2"></label><span class="switch-bg"></span>
	   	<span data-on="Fancy" data-off="Fast" class="switch-labels"></span>
	   </span>
	   <a onclick="cheatNow()" class="tooltip" title="You don't really want to do this.">Enter Cheat</a> 
	   <a class="intro tooltip dev" onclick="clearCookie()" title="Delete the Savegame you had. Refresh then to start a new game!">Clear Save</a>
	   
	   <br>
	   <textarea spellcheck="false" name="Text1" onclick="this.focus();this.select()" cols="55" rows="2" class="intro" id="saveForm"></textarea>
	</p>
</div>

<div class="contents">

	<div id="title">KUSHIFY</div>

	<div id="intro">
		<span id="introtext">Hey there!</span><br><br>
		<a id="introbutton" href="#" style="display: none;" onclick="introHandler()">></a><br>
		<a id="skipintro" href="#" onclick="skipIntro()" style="display:none; color:#fff; font-size: 18px;">Skip Intro >></a>
	</div>


	<div class="intro" id="fertilizer" onclick="clicked('fertilizer')">
		<span id="fertilizerspan"></span>
		<div class="intro fps" onclick="clicked('fertilizer')">0</div>
	</div>
	
	
	<div class="intro" id="weed" onclick="clicked('weed')">
		<span id="weedspan"></span>
		<div class="intro wps" onclick="clicked('weed')">0</div>
	</div>
	

	<div class="intro" id="money" onclick="clicked('money')">
		<span id="moneyspan"></span>
		<div class="intro mps" onclick="clicked('money')">0</div>
	</div>


	<canvas id="myCanvas" width="500" height="500" style="position: absolute;z-index: -1;top: 0;"></canvas>

	<div class="arrow ftow tooltip intro" title="The amount of fertilizer spent on growing plants.">0</div>
	<div class="arrow wtom tooltip intro" title="The amount of plants consumed by your trades.">0</div>
	<div class="arrow mtof tooltip intro" title="The amount of money spent on fertilizer.">0</div>
		

	<div id="containerftow" class="intro">
		<div id="list">
			<span class="intro trailer" onclick="buyStuff('trailer')">0 Trailer - buy for 30$</span>
			<span class="intro appartment" onclick="buyStuff('appartment')">0 Hippie Appartments - buy for 5,000$</span>
			<span class="intro greenhouse" onclick="buyStuff('greenhouse')">0 Greenhouses - buy for 140,000$</span>
			
		</div>
	</div>

	<div id="containerwtom" class="intro">
		<div id="list">
			<span class="intro dealer" onclick="buyStuff('dealer')">0 Dealer - buy for 15$</span>
			<span class="intro export1" onclick="buyStuff('export1')">0 Coffee Shops - buy for 3,000$</span>
			<span class="intro export2" onclick="buyStuff('export2')">0 Mafia Contracts - buy for 100,000$</span>
		</div>
	</div>

	<div id="containermtof" class="intro">
		<div id="list">
			<span class="intro fakefarm" onclick="buyStuff('fakefarm')">0 Undercover Farms - buy for 40$</span>
			<span class="intro fakefarm2" onclick="buyStuff('fakefarm2')">0 Nuclear Waste Facility - buy for 3,500$</span>
			<span class="intro enchantcursor1" onclick="buyStuff('enchantcursor1')">0 Cursor Enchantments - buy for 500g</span>
		</div>
	</div>

	<div id="alertMessage">Game Saved!</div>
	<div id="alertMessage2">Save unsuccessful!</div>
	<div id="alertMessage3">Game Loaded!</div>
</div>

<script type="text/javascript">
	window.requestAnimFrame = (function () {
		return  window.requestAnimationFrame ||
			window.webkitRequestAnimationFrame ||
			window.mozRequestAnimationFrame ||
			window.oRequestAnimationFrame ||
			window.msRequestAnimationFrame ||
			function (callback) {
				window.setTimeout(callback, 1000 / 60);
			};
	})();

	Math.randMinMax = function(min, max, round) {
		var val = min + (Math.random() * (max - min));
		
		if( round ) val = Math.round( val );
		
		return val;
	};
	Math.TO_RAD = Math.PI/180;
	Math.getAngle = function( x1, y1, x2, y2 ) {
		
		var	dx = x1 - x2,
			dy = y1 - y2;
		
		return Math.atan2(dy,dx);
	};
	Math.getDistance = function( x1, y1, x2, y2 ) {
		
		var 	xs = x2 - x1,
			ys = y2 - y1;		
		
		xs *= xs;
		ys *= ys;
		 
		return Math.sqrt( xs + ys );
	};

	var 	FX = {};

	(function() {
		
		var	canvas = document.getElementById('myCanvas'),
			ctx = canvas.getContext('2d'),
			lastUpdate = new Date(),
			mouseUpdate = new Date(),
			lastMouse = [],
			width, height;

		FX.particles = [];

		setFullscreen();
		document.getElementById('money').addEventListener('mousedown', buttonEffect);
		document.getElementById('weed').addEventListener('mousedown', buttonEffect2);
		document.getElementById('fertilizer').addEventListener('mousedown', buttonEffect3);

		function buttonEffect() {

			var button = document.getElementById('money'),
				height = button.offsetHeight,
				left = button.offsetLeft,
				top = button.offsetTop,
				width = button.offsetWidth,
				x, y, degree;

			for(var i=0;i<40;i=i+1) {

				if( Math.random() < 0.5 ) {

					y = Math.randMinMax(top, top+height);

					if( Math.random() < 0.5 ) {
						x = left;
						degree = Math.randMinMax(-45,45);
					} else {
						x = left + width;
						degree = Math.randMinMax(135,225);
					}
          
				} else {

					x = Math.randMinMax(left, left+width);

					if( Math.random() < 0.5 ) {
						y = top;
						degree = Math.randMinMax(45,135);
					} else {
						y = top + height;
						degree = Math.randMinMax(-135, -45);
					}
					
				}
				createParticle({
					x: x,
					y: y,
					degree: degree,
					vs: Math.randMinMax(-9,-5)
				});
			}
		}

		function buttonEffect2() {

			var button = document.getElementById('weed'),
				height = button.offsetHeight,
				left = button.offsetLeft,
				top = button.offsetTop,
				width = button.offsetWidth,
				x, y, degree;

			for(var i=0;i<40;i=i+1) {

				if( Math.random() < 0.5 ) {

					y = Math.randMinMax(top, top+height);

					if( Math.random() < 0.5 ) {
						x = left;
						degree = Math.randMinMax(-45,45);
					} else {
						x = left + width;
						degree = Math.randMinMax(135,225);
					}
          
				} else {

					x = Math.randMinMax(left, left+width);

					if( Math.random() < 0.5 ) {
						y = top;
						degree = Math.randMinMax(45,135);
					} else {
						y = top + height;
						degree = Math.randMinMax(-135, -45);
					}
					
				}
				if (coffeeMod === true) {
					createParticle({
						x: x,
						y: y,
						degree: degree,
						color: 'hsla('+ Math.randMinMax(20, 40) +', ' + Math.randMinMax(20, 50) + '%, ' + Math.randMinMax(20, 70) + '%, '+(Math.random().toFixed(2))+')',
						vs: Math.randMinMax(-9,-5)
					});
				}
				else {
					createParticle({
						x: x,
						y: y,
						degree: degree,
						color: 'hsla('+ Math.randMinMax(100, 155) +', 100%, 50%, '+(Math.random().toFixed(2))+')',
						vs: Math.randMinMax(-9,-5)
					});
				}

				
			}
		}

		function buttonEffect3() {

			var button = document.getElementById('fertilizer'),
				height = button.offsetHeight,
				left = button.offsetLeft,
				top = button.offsetTop,
				width = button.offsetWidth,
				x, y, degree;

			for(var i=0;i<40;i=i+1) {

				if( Math.random() < 0.5 ) {

					y = Math.randMinMax(top, top+height);

					if( Math.random() < 0.5 ) {
						x = left;
						degree = Math.randMinMax(-45,45);
					} else {
						x = left + width;
						degree = Math.randMinMax(135,225);
					}
          
				} else {

					x = Math.randMinMax(left, left+width);

					if( Math.random() < 0.5 ) {
						y = top;
						degree = Math.randMinMax(45,135);
					} else {
						y = top + height;
						degree = Math.randMinMax(-135, -45);
					}
					
				}
				createParticle({
					x: x,
					y: y,
					degree: degree,
					color: 'hsla('+ Math.randMinMax(170, 210) +', 100%, 50%, '+(Math.random().toFixed(2))+')',
					vs: Math.randMinMax(-9,-5)
				});
			}
		}

		window.setTimeout(buttonEffect2, 100); 

		loop();

		window.addEventListener('resize', setFullscreen );

		function createParticle( args ) {
			if (particlesDeactivated === true) {return}

			var options = {
				x: width/2,
				y: height/2,
				color: 'hsla('+ Math.randMinMax(60, 110) +', 100%, 50%, '+(Math.random().toFixed(2))+')', //the first two numbers are the color spectrum, from yellow to 
				degree: Math.randMinMax(0, 360),
				speed: Math.randMinMax(120, 170),
				vd: Math.randMinMax(-90,90),
				vs: Math.randMinMax(-8,-5)
			};

			for (key in args) {
			  options[key] = args[key];
			}

			FX.particles.push( options );
		}

		function loop() {

			var 	thisUpdate = new Date(),
				delta = (lastUpdate - thisUpdate) / 1000,
				amount = FX.particles.length,
				size = 3,
				i = 0,
				p;

			ctx.fillStyle = 'rgba(25,25,25,0.45)';
			ctx.fillRect(0,0,width,height);

			ctx.globalCompositeStyle = 'lighter';

			for(;i<amount;i=i+1) {

				p = FX.particles[ i ];

				p.degree += (p.vd * delta);
				p.speed += (p.vs);// * delta);
				if( p.speed < 0 ) continue;

				p.x += Math.cos(p.degree * Math.TO_RAD) * (p.speed * delta);
				p.y += Math.sin(p.degree * Math.TO_RAD) * (p.speed * delta);

				ctx.save();
			
				ctx.translate( p.x, p.y );
				ctx.rotate( p.degree * Math.TO_RAD );

				ctx.fillStyle = p.color;
				ctx.fillRect( -size, -size, size*2, size*2 );

				ctx.restore();
			}

			lastUpdate = thisUpdate;

			requestAnimFrame( loop );
		}

		function setFullscreen() {
			width = canvas.width = window.outerWidth;
			height = canvas.height = window.outerHeight;
		};
	})();
</script>
<script type="text/javascript" src="js/meny.js"></script>
<script type="text/javascript">
	var meny = Meny.create({
    // The element that will be animated in from off screen
    menuElement: document.querySelector( '.meny' ),

    // The contents that gets pushed aside while Meny is active
    contentsElement: document.querySelector( '.contents' ),

    // The alignment of the menu (top/right/bottom/left)
    position: 'top',

    // The width of the menu (when using left/right position)
    height: 200,

    // Use mouse movement to automatically open/close
    mouse: true,

    // Use touch swipe events to open/close
    touch: true
});
</script>
</body>
</html>